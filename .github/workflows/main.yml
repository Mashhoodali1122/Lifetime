name: AvicaRDP
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # Auto restart every 6 hours

jobs:
  build:
    name: Start Building...
    runs-on: windows-latest
    timeout-minutes: 350  # Increased time limit
    
    steps:
      - name: Direct Avica Setup
        run: |
          Write-Host "🚀 Starting Avica setup directly..." -ForegroundColor Green
          
          # Download files directly
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/setup.py" -OutFile "setup.py"
          Invoke-WebRequest -Uri "https://download.avica.com/AvicaLite_v8.0.8.9.exe" -OutFile "Avica_setup.exe"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat" -OutFile "show.bat"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat" -OutFile "loop.bat"
          
          # Install Python packages
          python.exe -m pip install requests pyautogui telegraph --quiet
          
          # Enable RDP
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          
          # Set user password
          net user runneradmin TheDisa1a
          
          # Start Avica
          Write-Host "⚡ Starting Avica..." -ForegroundColor Yellow
          python -c "import pyautogui as pag; pag.click(897, 64, duration=2)" 2>$null
          Start-Process "Avica_setup.exe"
          
          # Run setup script
          python setup.py
          
          Write-Host "✅ Setup completed! Check for GoFile link!" -ForegroundColor Green
          
      - name: Setup System User
        run: |
          net user runneradmin TheDisa1a
          Write-Host "✅ System user configured" -ForegroundColor Green

      - name: Start Avica Service
        run: cmd /c show.bat

      import time
from pywinauto.application import Application

def minimize_window(cmd):
    """
    Finds a window by its title and minimizes it.

    :param cmd: The title of the window to minimize.
    """
    try:
        # Find the application window by its title
        app = Application(backend="win32").connect(title=cmd, found_index=0)
        
        # Get the main window of the application
        main_window = app.window(title=cmd)
        
        # Check if the window exists and is not already minimized
        if main_window.exists() and not main_window.is_minimized():
            print(f"Minimizing window: '{cmd}'")
            main_window.minimize()
            print("Window minimized successfully.")
        elif main_window.is_minimized():
            print(f"Window '{cmd}' is already minimized.")
        else:
            print(f"Window with title '{cmd}' not found.")

    except Exception as e:
        print(f"An error occurred: {e}")

# Example Usage:
# Replace "Untitled - Notepad" with the actual title of the window you want to minimize.
# Make sure the window is open and visible on the remote desktop.
window_to_minimize = "Untitled - Notepad"

# Give some time for the window to be visible
time.sleep(2)

minimize_window(window_to_minimize)

          
      - name: Show Connection Info
        run: |
          Write-Host "
          ╔══════════════════════════════════════╗
          ║        AVICA RDP CONNECTION          ║  
          ╚══════════════════════════════════════╝
          
          📱 Telegram : @TheNetworkZoneOfficial
          👨‍💻 Credits : @PiroYadav & @TheYadavNetwork
          
          📋 Instructions:
          • Go to the GoFile link that will appear below
          • Get Avica ID and Password from there
          • Download Avica app and connect
          • GoFile link changes every time!
          
          ⏳ Waiting for GoFile link...
          " -ForegroundColor Cyan
        
      - name: Keep Session Active
        run: |
          Write-Host "🚀 Avica is starting... Look for CONNECTION ID below!" -ForegroundColor Yellow
          cmd /c loop.bat
